CREATE TABLE person (id SERIAL NOT NULL, first_name TEXT NOT NULL, last_name TEXT NOT NULL, matricule TEXT DEFAULT '', uid TEXT DEFAULT NULL, email TEXT DEFAULT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX unq_person_uid ON person (uid);
COMMENT ON COLUMN person.first_name IS 'First name';
COMMENT ON COLUMN person.last_name IS 'Last name';
COMMENT ON COLUMN person.matricule IS 'Institution internal identifier (matricule)';
COMMENT ON COLUMN person.uid IS 'Unique identifier associated from AD (Active Directory)';
COMMENT ON COLUMN person.email IS 'Person main email';
CREATE TABLE person_entry (id SERIAL NOT NULL, person_ref INT NOT NULL, entry_date DATE DEFAULT 'now()' NOT NULL CONSTRAINT person_entry_entry_date CHECK (CASE WHEN exit_date IS NOT NULL THEN entry_date IS NOT NULL OR entry_date <= exit_date END), exit_date DATE DEFAULT NULL CONSTRAINT person_entry_exit_date CHECK (CASE WHEN entry_date IS NULL THEN exit_date IS NULL ELSE exit_date IS NULL OR exit_date >= entry_date END), PRIMARY KEY(id));
CREATE INDEX IDX_871782B49722F9B8 ON person_entry (person_ref);
COMMENT ON COLUMN person_entry.entry_date IS 'Entry date of the person';
COMMENT ON COLUMN person_entry.exit_date IS 'Exit date of the person';
ALTER TABLE person_entry ADD CONSTRAINT FK_871782B49722F9B8 FOREIGN KEY (person_ref) REFERENCES person (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
CREATE TABLE department (id SERIAL NOT NULL, parent_ref INT DEFAULT NULL, level TEXT NOT NULL, path TEXT DEFAULT '/' NOT NULL, name_fr TEXT NOT NULL, name_en TEXT NOT NULL, name_nl TEXT NOT NULL, is_active BOOLEAN DEFAULT 'true' NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_CD1DE18A2FCC5DC6 ON department (parent_ref);
COMMENT ON COLUMN department.level IS 'Level in the hierarchy of organization';
COMMENT ON COLUMN department.path IS 'Hierarchic path of id in the organization';
COMMENT ON COLUMN department.name_fr IS 'Name of department/service in french';
COMMENT ON COLUMN department.name_en IS 'Name of department/service in english';
COMMENT ON COLUMN department.name_nl IS 'Name of department/service in dutch';
COMMENT ON COLUMN department.is_active IS 'Flag telling if the entry is active or not';
ALTER TABLE department ADD CONSTRAINT FK_CD1DE18A2FCC5DC6 FOREIGN KEY (parent_ref) REFERENCES department (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
CREATE TABLE working_duty (id SERIAL NOT NULL, person_ref INT NOT NULL, department_ref INT NOT NULL, percentage INT DEFAULT 100 NOT NULL, start_date DATE DEFAULT NULL, end_date DATE DEFAULT NULL, comment VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_FBCAD2639722F9B8 ON working_duty (person_ref);
CREATE INDEX IDX_FBCAD26369791980 ON working_duty (department_ref);
COMMENT ON COLUMN working_duty.percentage IS 'Duty percentage of the person in this department';
COMMENT ON COLUMN working_duty.start_date IS 'Start date of person in this department';
COMMENT ON COLUMN working_duty.end_date IS 'End date of person in this department';
COMMENT ON COLUMN working_duty.comment IS 'Associated description of this duty';
ALTER TABLE working_duty ADD CONSTRAINT FK_FBCAD2639722F9B8 FOREIGN KEY (person_ref) REFERENCES person (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE working_duty ADD CONSTRAINT FK_FBCAD26369791980 FOREIGN KEY (department_ref) REFERENCES department (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
